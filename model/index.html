<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Model · ContextualBandits.jl</title><meta name="title" content="Model · ContextualBandits.jl"/><meta property="og:title" content="Model · ContextualBandits.jl"/><meta property="twitter:title" content="Model · ContextualBandits.jl"/><meta name="description" content="Documentation for ContextualBandits.jl."/><meta property="og:description" content="Documentation for ContextualBandits.jl."/><meta property="twitter:description" content="Documentation for ContextualBandits.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">ContextualBandits.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Introduction</a></li><li><a class="tocitem" href="../gettingstarted/">Getting Started</a></li><li class="is-active"><a class="tocitem" href>Model</a><ul class="internal"><li><a class="tocitem" href="#Linear-Model-with-Labeling"><span>Linear Model with Labeling</span></a></li></ul></li><li><a class="tocitem" href="../simulation/">Simulation</a></li><li><a class="tocitem" href="../policies/">Policies</a></li><li><a class="tocitem" href="../outcome_models/">Outcome Models</a></li><li><a class="tocitem" href="../covariates_generation/">Covariates Generation</a></li><li><a class="tocitem" href="../examples/">Examples</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Model</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Model</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/andres-alban/ContextualBandits.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/andres-alban/ContextualBandits.jl/blob/main/docs/src/model.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Model"><a class="docs-heading-anchor" href="#Model">Model</a><a id="Model-1"></a><a class="docs-heading-anchor-permalink" href="#Model" title="Permalink"></a></h1><p>There are many &quot;flavors&quot; of bandit models and this package is not comprehensive. Therefore, users must understand the underlying model for which this package was designed. The contextual bandit model that we present here was formally introduced in the paper <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=4160045">Alban A, Chick SE, Zoumpoulis SI (2024) Learning Personalized Treatment Strategies with Predictive and Prognostic Covariates in Adaptive Clinical Trials</a>.  We introduce some terminology that will be used throughout this documentation. </p><p>A <strong>trial</strong> is a sequence of allocations of <code>T</code> <strong>subjects</strong> to one of <code>n</code> alternative <strong>treatments</strong> (arms). Before allocating each subject, we observe a context, which is a vector with <code>m</code> <strong>covariates</strong>. After each allocation of a subject, we observe the <strong>outcome</strong>, a noisy scalar that represents how effective the treatment is for the subject (higher values are better). By the end of the trial, we have gathered the following data:</p><ol><li><code>W</code>: a <code>T</code>-dimensional vector of integers in <code>1:n</code> of the treatments allocated to each subject.</li><li><code>X</code>: a <code>m</code>x<code>T</code>-dimensional matrix where each column is the vector of covariates for a subject. Notice that Julia stores arrays in <a href="https://docs.julialang.org/en/v1/manual/performance-tips/#man-performance-column-major">column-major order</a>.</li><li><code>Y</code>: a <code>T</code>-dimensional vector of scalars with the outcome of each subject.</li></ol><h3 id="Policy"><a class="docs-heading-anchor" href="#Policy">Policy</a><a id="Policy-1"></a><a class="docs-heading-anchor-permalink" href="#Policy" title="Permalink"></a></h3><p>A <strong>policy</strong> makes allocation decisions: it decides to which treatment each subject is allocated. A policy is represented by a subtype of <code>Policy</code>:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ContextualBandits.Policy" href="#ContextualBandits.Policy"><code>ContextualBandits.Policy</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">Policy</code></pre><p>Supertype for contextual bandit policies.</p><p>The functions <a href="#ContextualBandits.initialize!-Tuple{Policy}"><code>initialize!</code></a>, <a href="#ContextualBandits.state_update!-Tuple{Policy, Any, Any, Any}"><code>state_update!</code></a>, <a href="#ContextualBandits.allocation-Tuple{Policy, Vararg{Any, 4}}"><code>allocation</code></a>, and <a href="#ContextualBandits.implementation-Tuple{Policy, Vararg{Any, 4}}"><code>implementation</code></a> take subtypes of <code>Policy</code> as the first argument. Each subtype of Policy should implement these functions.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andres-alban/ContextualBandits.jl/blob/9633f2ba6560668c7c37acfbf8bc1ed91da81679/src/Policy/Policy.jl#L1-L8">source</a></section></article><p>The main method for any subtype of policy is <code>allocation</code>:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ContextualBandits.allocation-Tuple{Policy, Vararg{Any, 4}}" href="#ContextualBandits.allocation-Tuple{Policy, Vararg{Any, 4}}"><code>ContextualBandits.allocation</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">allocation(policy::Policy,Xcurrent,W,X,Y[, rng])</code></pre><p>Return a treatment to allocate a patient with covariates <code>Xcurrent</code>, given that the trial has observed <code>W</code>, <code>X</code>, and <code>Y</code>. <code>W</code> is the vector of treatments, <code>X</code> is the matrix of covariates, and <code>Y</code> is the vector of outcomes.</p><p>The dimension of <code>Y</code> may be smaller than that of <code>W</code> and <code>X</code> because of delays in outcomes.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andres-alban/ContextualBandits.jl/blob/9633f2ba6560668c7c37acfbf8bc1ed91da81679/src/Policy/Policy.jl#L31-L38">source</a></section></article><p>The allocation depends only on the available data <code>W,X,Y</code> when the allocation is made. However, the policy can also maintain a <strong>state</strong>. A state can be useful for computational efficiency. For instance, a linear regression model can be updated sequentially rather than retrained for every allocation. To maintain a state, the policy is first initialized and then updated after every observation:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ContextualBandits.initialize!-Tuple{Policy}" href="#ContextualBandits.initialize!-Tuple{Policy}"><code>ContextualBandits.initialize!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">initialize!(policy::Policy[, W, X, Y])</code></pre><p>Initialize the state of a policy before a trial starts. <code>W</code>, <code>X</code>, and <code>Y</code> is data collected in a pilot that can be used to initialize the policy.  <code>W</code> is the vector of treatments, <code>X</code> is the matrix of covariates, and <code>Y</code> is the vector of outcomes.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andres-alban/ContextualBandits.jl/blob/9633f2ba6560668c7c37acfbf8bc1ed91da81679/src/Policy/Policy.jl#L11-L17">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ContextualBandits.state_update!-Tuple{Policy, Any, Any, Any}" href="#ContextualBandits.state_update!-Tuple{Policy, Any, Any, Any}"><code>ContextualBandits.state_update!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">state_update!(policy::Policy,W,X,Y[, rng])</code></pre><p>Update the state of a policy given the data <code>W</code>, <code>X</code>, and <code>Y</code>. <code>W</code> is the vector of treatments, <code>X</code> is the matrix of covariates, and <code>Y</code> is the vector of outcomes.</p><p>For example, the policy may do Bayesian updating to get posterior parameters.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andres-alban/ContextualBandits.jl/blob/9633f2ba6560668c7c37acfbf8bc1ed91da81679/src/Policy/Policy.jl#L21-L27">source</a></section></article><p>A policy may also define an <strong>implementation</strong> that determines which treatment a subject arriving post-trial (once the trial has concluded and no more data is being gathered):</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ContextualBandits.implementation-Tuple{Policy, Vararg{Any, 4}}" href="#ContextualBandits.implementation-Tuple{Policy, Vararg{Any, 4}}"><code>ContextualBandits.implementation</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">implementation(policy::Policy,X_post,W,X,Y)</code></pre><p>Implement a treatment for covariates X_post given that the trial observed <code>W</code>, <code>X</code>, and <code>Y</code>. <code>W</code> is the vector of treatments, <code>X</code> is the matrix of covariates, and <code>Y</code> is the vector of outcomes.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andres-alban/ContextualBandits.jl/blob/9633f2ba6560668c7c37acfbf8bc1ed91da81679/src/Policy/Policy.jl#L43-L48">source</a></section></article><p>In <a href="../policies/#Policies">Policies</a>, we present the policies provided by this package. You can define your own policy by creating a subtype of <code>Policy</code> that defines methods for the above functions.</p><h3 id="Covariates"><a class="docs-heading-anchor" href="#Covariates">Covariates</a><a id="Covariates-1"></a><a class="docs-heading-anchor-permalink" href="#Covariates" title="Permalink"></a></h3><p>The covariates <code>X</code> are random draws from a distribution <code>FX</code>, which are independent between subjects. The package provides <a href="../covariates_generation/#ContextualBandits.CovariatesGeneration.CovariatesIndependent"><code>CovariatesIndependent</code></a> and <a href="../covariates_generation/#ContextualBandits.CovariatesGeneration.CovariatesCopula"><code>CovariatesCopula</code></a>, which are described in <a href="../covariates_generation/#Covariates-Generation">Covariates Generation</a>, to randomly generate covariates. As an example, a covariate that follows a standard normal distribution can be generated as follows:</p><pre><code class="language-julia hljs">using ContextualBandits
using Distributions

FX = CovariatesIndependent([Normal()])
X = rand(FX)</code></pre><h3 id="Outcomes"><a class="docs-heading-anchor" href="#Outcomes">Outcomes</a><a id="Outcomes-1"></a><a class="docs-heading-anchor-permalink" href="#Outcomes" title="Permalink"></a></h3><p>The outcomes of a trial, <code>Y</code>, are generated by an <strong>outcome model</strong>:</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ContextualBandits.OutcomeModel" href="#ContextualBandits.OutcomeModel"><code>ContextualBandits.OutcomeModel</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">OutcomeModel</code></pre><p>Supertype for models that determine mean outcomes and noisy outcomes.</p><p>The functions <a href="#ContextualBandits.outcome_model_state!"><code>outcome_model_state!</code></a>, <a href="#ContextualBandits.mean_outcome"><code>mean_outcome</code></a>, <a href="#ContextualBandits.noisy_outcome"><code>noisy_outcome</code></a>, and  <a href="#ContextualBandits.noise_outcome"><code>noise_outcome</code></a> take subtypes of <code>OutcomeModel</code> as the first argument. Each subtype should implement these functions.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andres-alban/ContextualBandits.jl/blob/9633f2ba6560668c7c37acfbf8bc1ed91da81679/src/OutcomeModel/OutcomeModel.jl#L1-L9">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ContextualBandits.mean_outcome" href="#ContextualBandits.mean_outcome"><code>ContextualBandits.mean_outcome</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">mean_outcome(outcome_model::OutcomeModel,W,X)</code></pre><p>Compute the mean outcome of treatment <code>W</code> with covariates <code>X</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andres-alban/ContextualBandits.jl/blob/9633f2ba6560668c7c37acfbf8bc1ed91da81679/src/OutcomeModel/OutcomeModel.jl#L21-L25">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ContextualBandits.noise_outcome" href="#ContextualBandits.noise_outcome"><code>ContextualBandits.noise_outcome</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">noise_outcome(outcome_model::OutcomeModel,rng::AbstractRNG=Random.GLOBAL_RNG)</code></pre><p>Generate noise object to be passed to <a href="#ContextualBandits.noisy_outcome">noisy_outcome</a>.</p><p>It can generate a normal distribution with zero mean for Gaussian models or vectors of random variables for more complex models.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andres-alban/ContextualBandits.jl/blob/9633f2ba6560668c7c37acfbf8bc1ed91da81679/src/OutcomeModel/OutcomeModel.jl#L42-L48">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ContextualBandits.noisy_outcome" href="#ContextualBandits.noisy_outcome"><code>ContextualBandits.noisy_outcome</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">noisy_outcome(outcome_model::OutcomeModel,W,X,Z)</code></pre><p>Compute noisy outcome of treatment <code>W</code> with covariates <code>X</code> given noise <code>Z</code>.  <code>Z</code> is generated with <a href="#ContextualBandits.noise_outcome"><code>noise_outcome</code></a>.</p><p>Usually calls <a href="#ContextualBandits.mean_outcome"><code>mean_outcome</code></a> and adds zero mean noise <code>Z</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andres-alban/ContextualBandits.jl/blob/9633f2ba6560668c7c37acfbf8bc1ed91da81679/src/OutcomeModel/OutcomeModel.jl#L30-L37">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ContextualBandits.outcome_model_state!" href="#ContextualBandits.outcome_model_state!"><code>ContextualBandits.outcome_model_state!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">outcome_model_state!(outcome_model::OutcomeModel,rng::AbstractRNG=Random.GLOBAL_RNG)</code></pre><p>Set the state of an outcome model. Mainly used to change the state of random instances.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andres-alban/ContextualBandits.jl/blob/9633f2ba6560668c7c37acfbf8bc1ed91da81679/src/OutcomeModel/OutcomeModel.jl#L12-L16">source</a></section></article><p>In <a href="../outcome_models/#Outcome-Models">Outcome Models</a>, we present the outcome models provided by this package. You can define your own model by creating a subtype of <code>OutcomeModel</code> that defines methods for the above functions.</p><h3 id="Delay"><a class="docs-heading-anchor" href="#Delay">Delay</a><a id="Delay-1"></a><a class="docs-heading-anchor-permalink" href="#Delay" title="Permalink"></a></h3><p>The model allows for fixed delays in observing the outcomes. <a href="../simulation/#ContextualBandits.simulation_stochastic"><code>simulation_stochastic</code></a> accepts <code>delay</code> as an integer parameter that determines the number of subjects that are allocated before the outcome of a subject is observed. For example if <code>delay=3</code>, then the outcome of subject 1 will be observed only after the allocation of subject 4.</p><h3 id="Simulation-of-a-Trial"><a class="docs-heading-anchor" href="#Simulation-of-a-Trial">Simulation of a Trial</a><a id="Simulation-of-a-Trial-1"></a><a class="docs-heading-anchor-permalink" href="#Simulation-of-a-Trial" title="Permalink"></a></h3><p>The model can be understood with the following code snippet that broadly illustrates how the different components enter in a simulation. A simulation will perform this code for many replications, record metrics, and summarize the metrics. See <a href="../simulation/#Simulation">Simulation</a> for more details on the simulation functions.</p><pre><code class="language-julia hljs"># ...
# loop over subjects in trial
initialize!(policy)
for t in 0:(T+delay)
    # Allocate
    if 1 &lt;= t &lt;= T
        # Covariates of the newly arrived subject that has not yet been treated
        Xcurrent = rand(FX)
        w = allocation(policy,Xcurrent,view(W,1:(t-1)),view(X,:,1:(t-1)),view(Y,1:(t-delay-1)),rng)
        @assert w in 1:n &quot;The policy $(typeof(policy)) made an allocation outside the range 1-$n&quot;
        X[:,t] = Xcurrent
        W[t] = w
        Y[t] = noisy_outcome(outcome_model,w,view(X,:,t),Z[t])
    end

    # Available data at time t
    Wav = view(W,1:min(t,T))
    Xav = view(X,:,1:min(t,T))
    Yav = view(Y,1:(t-delay))

    # Update state of policy
    state_update!(policy,Wav,Xav,Yav,rng)
end</code></pre><h3 id="Metrics-and-performance"><a class="docs-heading-anchor" href="#Metrics-and-performance">Metrics and performance</a><a id="Metrics-and-performance-1"></a><a class="docs-heading-anchor-permalink" href="#Metrics-and-performance" title="Permalink"></a></h3><p>We distinguish between two types of metrics: <strong>online</strong> and <strong>offline</strong>. Online performance metrics refer to performance associated with the subjects allocated in the trial, while offline refers to the outcome of subjects that would be allocated to treatment post-trial once an implementation has been chosen. <strong>Regret</strong> for a subject with covariates <code>x</code> allocated to treatment <code>w</code> is defined as follows:</p><pre><code class="nohighlight hljs">regret = maximum([mean_outcome(outcome_model, wmax, x) - mean_outcome(outcome_model, w, x) for wmax in 1:n])</code></pre><p>For subjects allocated in the trial, we refer to it as online regret, and for subjects that received the treatment as the post-trial implementation, we refer to it as offline regret. In <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=4160045">Alban, Chick, Zoumpoulis (2024)</a> offline regret is referred to as Expected Opportunity Cost (EOC).</p><p>Another important metric is <strong>Probability of Incorrect Selection (PICS)</strong>:</p><pre><code class="nohighlight hljs">PICS = regret &gt; 0</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>This package assumes that larger values of the output are better when computing regret and for designing policies.</p></div></div><p>More detail is provided in the output of the <a href="../simulation/#Simulation">Simulation</a>.</p><h2 id="Linear-Model-with-Labeling"><a class="docs-heading-anchor" href="#Linear-Model-with-Labeling">Linear Model with Labeling</a><a id="Linear-Model-with-Labeling-1"></a><a class="docs-heading-anchor-permalink" href="#Linear-Model-with-Labeling" title="Permalink"></a></h2><p>A common way to model the the outcomes as a function of the covariates and treatment is through linear model. Most effective policies require a statistical model that learns the coefficients of the linear model. The vast majority of implemented policies in this package use <a href="https://en.wikipedia.org/wiki/Bayesian_linear_regression">Bayesian Linear Regression</a> to learn those coefficients. We use <code>mu</code> as the true coefficients of the model that are generating the outcomes. <code>theta</code> is the prior/posterior estimate of <code>mu</code> and <code>Sigma</code> is the prior/posterior covariance matrix of the Bayesian linear regression.</p><p>A reasonable way to implement a linear model is to model each treatment separately. However, we use a more flexible framework of interaction between treatment and covariates with a <code>labeling</code> (see <a href="#Labeling">Labeling</a> for details). Thus, the final model is <code>Y = interact(W,n,X,labeling) * mu + sigma * randn()</code>, where <code>sigma^2</code> is the standard deviation of the noise. <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=4160045">Alban, Chick, Zoumpoulis (2024)</a> uses the operator <span>$\otimes$</span> to represent the <code>interact</code> function.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ContextualBandits.interact" href="#ContextualBandits.interact"><code>ContextualBandits.interact</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">interact(w, n, x[, labeling])</code></pre><p>Interact a treatment <code>w</code> among <code>n</code> treatment alternatives with covariate vector <code>x</code> (<code>m=length(x)</code>).</p><p>When labeling is not provided, the function returns a vector <code>WX</code> of length <code>m*n</code>, where all entries are zeros except for <code>WX[(w-1)*m+1:w*m] = x</code>. <code>WX</code> is split into <code>n</code> blocks of size <code>m</code>, where the <code>w</code>-th block is equal to <code>x</code>.</p><p>When <code>labeling</code> is provided, the function returns a vector <code>WX</code> of length <code>sum(labeling)</code>. <code>labeling</code> is a boolean vector of length <code>(n+1)*m</code> that indicates which covariates are predictive and which are prognostic. The first <code>m</code> entries correspond to prognostic terms, the following <code>m</code> entries correspond to the terms predictive with respect to treatment 1, then <code>m</code> entries for treatment 2, and so on.</p><p>If <code>w</code> is a vector, then <code>x</code> must be a matrix such that <code>length(w)==size(x,2)</code>, and the output is a matrix with <code>sum(labeling)</code> rows and <code>length(w)</code> columns.</p><p>See also: <a href="#ContextualBandits.interact!"><code>interact!</code></a></p><p>#Examples</p><pre><code class="language-julia-repl hljs">julia&gt; w = 2;
       n = 2;
       x = [1,3,4]
       interact(w, n, x)
Vector{Float64}:
 0.0
 0.0
 0.0
 1.0
 3.0
 4.0</code></pre><pre><code class="language-julia-repl hljs">julia&gt; w = [1,2]
       n = 2
       x = [1 1;
            2 3;
            5 4]
       labeling = Bool.([1,1,0,0,0,1,0,1,0])
       interact(w,n,x,labeling)
4×2 Matrix{Float64}:
 1.0  1.0
 2.0  3.0
 5.0  0.0
 0.0  3.0</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andres-alban/ContextualBandits.jl/blob/9633f2ba6560668c7c37acfbf8bc1ed91da81679/src/utils.jl#L59-L107">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ContextualBandits.interact!" href="#ContextualBandits.interact!"><code>ContextualBandits.interact!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">interact!(WX, w, n, x[, labeling])</code></pre><p>In-place version of <a href="#ContextualBandits.interact"><code>interact</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andres-alban/ContextualBandits.jl/blob/9633f2ba6560668c7c37acfbf8bc1ed91da81679/src/utils.jl#L117-L121">source</a></section></article><h3 id="Labeling"><a class="docs-heading-anchor" href="#Labeling">Labeling</a><a id="Labeling-1"></a><a class="docs-heading-anchor-permalink" href="#Labeling" title="Permalink"></a></h3><p>A labeling &quot;labels&quot; how each covariate interacts with each treatment. It is a boolean vector of size <code>(n+1)*m</code> split into <code>n+1</code> blocks of <code>m</code> entries. The first <code>m</code> entries represent <strong>prognostic</strong> covariates, those covariates that have an equal effect on all treatments. By default, all prognostic labels are <code>false</code>, meaning there are no prognostic effects. The remaining <code>n</code> blocks represent the <strong>predictive</strong> covariates with respect to the corresponding treatment, those covariates that have a treatment-specific effect. By default, all predictive labels are <code>true</code>, meaning each covariates has an effect specific to each treatment, or equivalently, each treatment has a separate model.</p><p>Generally, the first covariate is an intercept term that is <code>1</code> for all subjects. Thus, the first prognostic term represents an intercept term, and the first term for each block of predictive covariates are treatment effects.</p><h3 id="Bayesian-linear-regression"><a class="docs-heading-anchor" href="#Bayesian-linear-regression">Bayesian linear regression</a><a id="Bayesian-linear-regression-1"></a><a class="docs-heading-anchor-permalink" href="#Bayesian-linear-regression" title="Permalink"></a></h3><p>We use the following type to learn Bayesian linear regression models. Policies will often use this type</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ContextualBandits.BayesLinearRegression" href="#ContextualBandits.BayesLinearRegression"><code>ContextualBandits.BayesLinearRegression</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">BayesLinearRegression(n, m, theta0, Sigma0, sample_std[, labeling])</code></pre><p>Bayesian linear regression model with <code>n</code> treatments and <code>m</code> covariates.</p><p>See also: <a href="#ContextualBandits.initialize!-Tuple{Policy}">ContextualBandits.initialize!</a>, <a href="#ContextualBandits.state_update!-Tuple{Policy, Any, Any, Any}">ContextualBandits.state_update!</a>, <a href="#ContextualBandits.BayesUpdateNormal">BayesUpdateNormal</a>, <a href="#ContextualBandits.BayesUpdateNormal!">BayesUpdateNormal!</a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andres-alban/ContextualBandits.jl/blob/9633f2ba6560668c7c37acfbf8bc1ed91da81679/src/BayesLinearRegression.jl#L1-L8">source</a></section></article><p>This type needs to be first initialized and then data can be passed sequentially (or in batches) to update the posterior distribution.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ContextualBandits.initialize!-Tuple{BayesLinearRegression}" href="#ContextualBandits.initialize!-Tuple{BayesLinearRegression}"><code>ContextualBandits.initialize!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">initialize!(model::BayesLinearRegression)</code></pre><p>Reset the posterior mean <code>model.theta_t</code> and covariance matrix <code>model.Sigma_t</code> to the prior  mean <code>theta0</code> and covariance matrix <code>Sigma0</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andres-alban/ContextualBandits.jl/blob/9633f2ba6560668c7c37acfbf8bc1ed91da81679/src/BayesLinearRegression.jl#L24-L29">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ContextualBandits.state_update!-Tuple{BayesLinearRegression, Any, Any, Any}" href="#ContextualBandits.state_update!-Tuple{BayesLinearRegression, Any, Any, Any}"><code>ContextualBandits.state_update!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">state_update!(model::BayesLinearRegression, W, X, Y)</code></pre><p>Update the posterior mean <code>model.theta_t</code> and covariance matrix <code>model.Sigma_t</code> after observing treatments <code>W</code>, covariates <code>X</code>, and outcomes <code>Y</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andres-alban/ContextualBandits.jl/blob/9633f2ba6560668c7c37acfbf8bc1ed91da81679/src/BayesLinearRegression.jl#L36-L41">source</a></section></article><p>To select a prior, the package provides the following utilities to generate the robust prior of <a href="https://papers.ssrn.com/sol3/papers.cfm?abstract_id=4160045">Alban, Chick, Zoumpoulis (2024)</a>.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ContextualBandits.default_prior_linear" href="#ContextualBandits.default_prior_linear"><code>ContextualBandits.default_prior_linear</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">default_prior_linear(n, m, sigma0, psi[, D, labeling])</code></pre><p>The default prior is a method to specify a prior for a linear model that only depends  on a few parameters. It returns the prior mean and covariance matrix for a linear model  with <code>n</code> treatments and <code>m</code> covariates. </p><p>The prior mean is a vector of zeros.</p><p>The prior covariance matrix (<code>Sigma0</code>) has <code>sigma0^2</code> in all entries of the diagonal. <code>psi</code> is the decay parameter for the covariance between coefficients of the same covariate and <code>D</code> is a symmetric distance matrix between treatments, which is of size <code>(n,n)</code>. Off-diagonal elements of the covariance matrix that represent the covariance between two predictive coefficient for the same covariate with respect to two different treatments, say <code>w1</code> and <code>w2</code>, are given by <code>sigma0^2*exp(-psi*D[w1,w2])</code>.</p><p><strong>Example</strong></p><pre><code class="language-julia hljs">n = 3
m = 3
sigma0 = 1.0
psi = log(2)
D = [0 1 2;
    1 0 1;
    2 1 0]
labeling = BitVector([0, 0, 1, 1, 1, 0, 1, 1, 0, 1, 1, 0])
theta0, Sigma0 = default_prior_linear(n, m, sigma0, psi, D, labeling)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andres-alban/ContextualBandits.jl/blob/9633f2ba6560668c7c37acfbf8bc1ed91da81679/src/Policy/robust_prior_linear.jl#L1-L30">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ContextualBandits.robustify_prior_linear!" href="#ContextualBandits.robustify_prior_linear!"><code>ContextualBandits.robustify_prior_linear!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">robustify_prior_linear!(theta0, Sigma0, n, m[, labeling, z_alpha, c])</code></pre><p>Robustify the prior mean vector <code>theta0</code> and covariance matrix <code>Sigma0</code> for a linear model with <code>n</code> treatments and <code>m</code> covariates. <code>theta0</code> elements that are predictive are artificially increased by a factor of <code>z_alpha</code> times the square root of the largest element of <code>Sigma0</code>. <code>Sigma0</code> is multiplied by scalar <code>c</code>.</p><p>By default <code>z_alpha=2</code> and <code>c=4</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andres-alban/ContextualBandits.jl/blob/9633f2ba6560668c7c37acfbf8bc1ed91da81679/src/Policy/robust_prior_linear.jl#L55-L64">source</a></section></article><h3 id="Additional-utilities"><a class="docs-heading-anchor" href="#Additional-utilities">Additional utilities</a><a id="Additional-utilities-1"></a><a class="docs-heading-anchor-permalink" href="#Additional-utilities" title="Permalink"></a></h3><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ContextualBandits.BayesUpdateNormal" href="#ContextualBandits.BayesUpdateNormal"><code>ContextualBandits.BayesUpdateNormal</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">BayesUpdateNormal(theta,Sigma,X,y,sample_std)</code></pre><p>Update Bayesian hyperparameters <code>theta</code> (mean vector) and <code>Sigma</code> (covariance matrix) of a linear regression model with regressor matrix <code>X</code>, outputs <code>y</code>, and sampling standard deviation <code>sample_std</code>.</p><p>Return a copy of the updated <code>theta</code> and <code>Sigma</code>.</p><p><code>X</code> can be a vector of regressors or a matrix of regressors, where each column is a vector of regressors. In the latter case, <code>y</code> and <code>sample_std</code> can be vectors of the same length as the number of columns of <code>X</code>.</p><p>See also: <a href="#ContextualBandits.BayesUpdateNormal!">BayesUpdateNormal!</a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andres-alban/ContextualBandits.jl/blob/9633f2ba6560668c7c37acfbf8bc1ed91da81679/src/BayesLinearRegression.jl#L66-L78">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="ContextualBandits.BayesUpdateNormal!" href="#ContextualBandits.BayesUpdateNormal!"><code>ContextualBandits.BayesUpdateNormal!</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">BayesUpdateNormal!(theta,Sigma,X,y,sample_std)</code></pre><p>In-place version of <a href="#ContextualBandits.BayesUpdateNormal">BayesUpdateNormal</a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/andres-alban/ContextualBandits.jl/blob/9633f2ba6560668c7c37acfbf8bc1ed91da81679/src/BayesLinearRegression.jl#L83-L87">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../gettingstarted/">« Getting Started</a><a class="docs-footer-nextpage" href="../simulation/">Simulation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.5.0 on <span class="colophon-date" title="Monday 29 July 2024 11:02">Monday 29 July 2024</span>. Using Julia version 1.10.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
